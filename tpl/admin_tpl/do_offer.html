<!DOCTYPE html>
<html>
<head>
    <title>后台系统</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- styles -->
    <link href="/css/styles.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<style type="text/css">
    .form-control {
        padding: 0px 5px;
        height: 28px
    }

    .brs {
        width: 100px;
        display: inline;
        border-radius: 0px
    }

    .btn_pro {
        padding-bottom: 20px
    }

    /*.attr_diabled{ position: relative}*/
    /*.attr_diabled:after{ content: ''; position: absolute; left: 0px; top: 0px; width: 100%; height: 100%; z-index: 99; background-color: #dedede; opacity: 0.6}*/

</style>
<%include("head.html"){}%>
<div class="page-content">
    <div class="row">
        <%include("left.html"){}%>
        <div class="col-md-10">
            <div class="content-box-large">
                <div class="panel-heading">
                    <div class="panel-title">产品报价</div>
                </div>

                <div class="panel-body form-horizontal">
                    <div class="row btn_pro" style="display: none">
                        <div class="col-md-10">
                            <span class="btn_pro_list">
                            </span>
                        </div>
                    </div>


                    <legend>固定配件</legend>
                    <div class="spare_list">
                        <!--配件内容-->
                    </div>

                    <legend>常用配件</legend>
                    <div class="s_spare_list">
                        <!--配件内容-->
                    </div>



                </div>
            </div>
        </div>
    </div>
</div>

<footer>
    <div class="container">

        <!--<div class="copy text-center">-->
        <!--Copyright 2014 <a href='#'>Website</a>-->
        <!--</div>-->

    </div>
</footer>

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="/js/jquery.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->


<script>
    $(function () {
        $.getdata("/v1/product/getProduct", {"id":${offer_id}}, function (res) {
            add_pro(res)
        })


    })


    _w['add_pro'] = function (data) {
        if (index >= 1) {
            getCurrentProduct()
        }
        products[index] = {};
        products[index]['id'] = data.id;
        products[index]['product_num'] = 100;
        Offer.show_pro_btn();
        Offer.add_pro_btn(data);
        Offer.clear_product();
        Offer.show_spare(data, $(".spare_list"));
        Offer.clear_common_spare();
    }

    _w['Offer'] = {
        "show_pro_btn": function (data) {
            $(".btn_pro").show();
            var s = '<button id="pro_btn_' + index + '" onclick="switch_pro(' + index + ')" class="btn-primary btn-default form-control brs">' + data.code + '</button>';
            $(".btn_pro").find(".btn_pro_list").find("button").removeClass("btn-primary")
            $(".btn_pro").find(".btn_pro_list").append(s)
            index++;
        },
        "add_pro_btn": function (data) {
            var products=data.productBeans,s= '';
            for (var i = 0; i < products.length; i++) {
                var s = '<button id="pro_btn_' + index + '" onclick="switch_pro(' + index + ')" class="btn-primary btn-default form-control brs">' + data.code + '</button>';
                $(".btn_pro").find(".btn_pro_list").find("button").removeClass("btn-primary")
                $(".btn_pro").find(".btn_pro_list").append(s)
            }
            index++;
        },
        "show_spare": function (data, t) {
            var spares = data.spareBeans, s = '';
            for (var i = 0; i < spares.length; i++) {
                s += '<h5>' + spares[i].name + '</h5>'
                s += '<div class="product_attr">';
                var attrBeans = spares[i].attrBeans;
                for (var j = 0; j < attrBeans.length; j++) {
                    var attr = new Attr(attrBeans[j]);
                    s += attr.getHtml();
                }
                s += '</div>'
            }
            t.append(s)
            bindAttr();

        },
        "show_common_spare": function (data, t) {
            var spares = data.spareBeans, s = '';
            for (var i = 0; i < spares.length; i++) {


                s += ' <label class="checkbox-inline"><input class="cs" data-id="' + spares[i].id + '" type="checkbox">'
                    + spares[i].name + '</label>'
                s += '<div id="product_attr_' + spares[i].id + '" class="product_attr attr_diabled">';
                var attrBeans = spares[i].attrBeans;
                for (var j = 0; j < attrBeans.length; j++) {
                    var attr = new Attr(attrBeans[j]);
                    s += attr.getHtml();
                }
                s += '</div>'
            }
            t.append(s)

            bindAttr();

            t.find(".cs").each(function () {
                var tt = $(this), id = tt.attr("data-id");
                $("#product_attr_" + id).find("select").attr("disabled", "disabled")
            })

            t.find(".input-num").each(function () {
                var tt = $(this)
                tt.attr("disabled", true)
            })

            t.find(".cs").on("change", function () {
                var tt = $(this), id = tt.attr("data-id");
                if (tt[0].checked) {
                    $("#product_attr_" + id).removeClass("attr_diabled")
                    $("#product_attr_" + id).find(".input-num").attr("disabled", false)
                    $("#product_attr_" + id).find("select").attr("disabled", false)
                } else {
                    $("#product_attr_" + id).find(".input-num").attr("disabled", true)
                    $("#product_attr_" + id).addClass("attr_diabled")
                    $("#product_attr_" + id).find("select").attr("disabled", true)
                }
            })
        },
        "clear_product": function () {
            $(".spare_list").html("")
        },
        "clear_common_spare": function () {
            $(".cs").each(function () {
                var tt = $(this), id = tt.attr("data-id");
                tt.attr('checked', false)
                tt[0].checked = false;
                $("#product_attr_" + id).find("select").attr("disabled", "disabled")
                $("#product_attr_" + id).find("select").val("")
            })
            $(".input-num").each(function () {
                var tt = $(this)
                tt.attr("disabled", true)
                tt.val("")
            })
        }
    }

</script>
</div>
</body>
</html>